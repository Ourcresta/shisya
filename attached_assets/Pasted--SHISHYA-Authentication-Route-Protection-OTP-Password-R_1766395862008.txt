

## **SHISHYA â€“ Authentication + Route Protection (OTP + Password)**

> **ROLE & EXPECTATION**
> You are a **Senior Full-Stack Architect, Security Engineer, and UX Engineer**.
> You must implement a **production-grade authentication system** for the **SHISHYA Student Portal** using **Email + Password + OTP (Resend)** with **strict route protection**.

This is **NOT a demo**. This is a **real ed-tech platform foundation**.

---

## ğŸ¯ GOAL

Implement:

1. **Signup with Email + Password + OTP (via Resend)**
2. **Login with Email + Password**
3. **Session-based authentication**
4. **Protected routes**
5. **Correct redirect logic**
6. **Header state management (logged-in vs logged-out)**

---

## ğŸ” AUTHENTICATION RULES (NON-NEGOTIABLE)

### Signup Flow

1. User enters:

   * Email
   * Password
2. OTP is generated (6 digits)
3. OTP sent via **Resend**
4. User verifies OTP
5. Account is activated
6. User is logged in automatically

### Login Flow

* Email + Password
* No OTP required
* Successful login â†’ session created

### Logout

* Session destroyed
* User redirected to `/login`

---

## ğŸ”’ ROUTE PROTECTION RULES (CRITICAL)

### âœ… Public Routes (No Login Required)

```
/
 /courses
 /courses/:courseId
 /verify/:certificateId   (public certificate verification)
 /login
 /signup
```

### ğŸ” Protected Routes (Login Required)

```
/courses/:courseId/learn
/courses/:courseId/learn/:lessonId
/courses/:courseId/projects
/courses/:courseId/projects/:projectId
/courses/:courseId/tests
/certificates
/profile
/labs
```

â— If a non-authenticated user accesses protected routes:
â¡ï¸ Redirect to `/login`
â¡ï¸ After login â†’ redirect back to intended page

---

## ğŸ§© TECH STACK (USE EXISTING)

### Frontend

* React + TypeScript
* Vite
* Tailwind + shadcn/ui
* Wouter (routing)
* React Context for Auth

### Backend

* Express.js
* Session-based auth (cookie)
* bcrypt for passwords
* Resend for OTP emails

---

## ğŸ—‚ï¸ FILE STRUCTURE (ENFORCE)

```
client/src/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ Login.tsx
â”‚   â”œâ”€â”€ Signup.tsx
â”‚   â”œâ”€â”€ VerifyOtp.tsx
â”‚   â””â”€â”€ ProtectedRoute.tsx
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ AuthContext.tsx
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ auth.ts
â”‚   â””â”€â”€ api.ts
â””â”€â”€ App.tsx

server/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ authRoutes.ts
â”‚   â”œâ”€â”€ otpService.ts
â”‚   â””â”€â”€ session.ts
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ requireAuth.ts
â””â”€â”€ index.ts
```

---

## ğŸ§  FRONTEND REQUIREMENTS

### AuthContext

Must expose:

```ts
user
isAuthenticated
login()
logout()
signup()
verifyOtp()
```

### ProtectedRoute Component

* Wraps protected pages
* Redirects unauthenticated users to `/login`

### Header Logic

| State      | Show                  |
| ---------- | --------------------- |
| Logged out | Login button          |
| Logged in  | Profile menu + Logout |

---

## ğŸ“§ OTP EMAIL REQUIREMENTS (Resend)

* Subject: `Your SHISHYA verification code`
* Body:

```
Your OTP is: 123456
This code expires in 10 minutes.
```

OTP rules:

* 6 digits
* Expiry: 10 minutes
* One active OTP per email

---

## ğŸ›¡ï¸ SECURITY REQUIREMENTS

* Hash passwords using bcrypt
* OTP stored hashed or time-bound
* Sessions stored securely
* No sensitive data in frontend
* Protect all APIs with auth middleware

---

## ğŸ”„ REDIRECT LOGIC (IMPORTANT)

* Access protected route â†’ redirect to `/login`
* After login â†’ redirect back to original route
* Store `redirectTo` in query or state

---

## ğŸ§ª TESTING CHECKLIST (YOU MUST VERIFY)

* Signup â†’ OTP â†’ login success
* Wrong OTP â†’ error
* Expired OTP â†’ error
* Login with wrong password â†’ error
* Protected route without login â†’ redirect
* Refresh page â†’ session persists
* Logout â†’ access revoked

---

## ğŸš« DO NOT

* Do NOT use mock auth
* Do NOT skip route guards
* Do NOT expose protected data publicly
* Do NOT hardcode OTPs

---

## âœ… FINAL OUTCOME EXPECTED

* Fully functional authentication system
* Clear separation of public vs protected pages
* Secure OTP-based signup
* Stable login sessions
* Production-ready foundation for SHISHYA

---

### â›³ START NOW

Implement step-by-step.
Do not jump ahead.
Confirm each stage works before moving forward.

---

If you want, next I can give:

* **Resend OTP email template**
* **Database schema for users**
* **JWT vs Session decision**
* **Auth + Admin sync later**

Just tell me ğŸ‘